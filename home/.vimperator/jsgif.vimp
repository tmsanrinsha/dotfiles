command! -nargs=0 -description="A GIF player in JavaScript" bkgif open javascript:(function(){var%20n=null,C=false;function%20h(m){d(m,"jsgif_overlaid");m.removeEventListener("click",i,C)}function%20i(m){var%20o=this;c.forEach(h);setTimeout(function(){j(o)},0);m.preventDefault()}function%20d(m,p){var%20o=m.className.split(/\s/).filter(function(r){return%20r!==p});m.className=g(o,"%20")}function%20g(m,o){if(o===undefined){o=""}return%20m.reduce(function(p,r){return%20p+o+r},"")}function%20j(ai){function%20ag(p,m){return%20function(q){p(q);T(m)}}function%20ac(){}function%20T(m){ab("Decoding%20(frame%20"+(M.length+1)+")...",Z.i,Z.data.length,m)}function%20I(){G=C;o.insertBefore(ai,L);o.removeChild(L)}function%20F(){N%26%26M.push({data:N.getImageData(0,0,ae.width,ae.height),f:Y})}function%20V(m){af=m;ae={width:ai.width,height:ai.height};M=[];O.fillStyle="black";O.fillRect(0,0,ae.width,ae.height);O.strokeStyle="red";O.lineWidth=3;O.moveTo(0,0);O.lineTo(ae.width,ae.height);O.moveTo(0,ae.height);O.lineTo(ae.width,0);O.stroke();setTimeout(x,0)}function%20ah(m){m.lengthComputable%26%26ab("Loading...",m.loaded,m.total,true)}function%20ab(u,p,r,t){K.style.visibility=p===r?"":"visible";if(t){t=Math.min(J.height>>3,J.height);var%20q=J.height-t>>1,m=p/r*J.width;O.fillStyle="rgba(255,160,122,0.5)";O.fillRect(m,q,J.width-m,t);O.fillStyle="rgba(0,128,128,0.5)";O.fillRect(0,q,p/r*J.width,t)}K.innerHTML=u+"%20"+Math.floor(p/r*100)+"%25"}function%20ad(){try{b(Z,aj)}catch(m){V("parse")}}var%20Z,ae,af=n,U=n,Y=n,w=n,s=n,N=n,G=true,P=true,M=[],x=function(){function%20y(){function%20S(){G=!G;aa();W.focus();u()}function%20aa(){if(G){W.innerHTML="%26#10073;%26#10073;";W.title="Pause";R.style.visibility="hidden";Q.style.visibility="hidden"}else{W.innerHTML=P?"%26#9654;":"%26#9664;";W.title="Play";R.style.visibility="";Q.style.visibility=""}K.style.visibility=r?"visible":"";z.style.display=m?"":"none";E.innerHTML="i";E.title="Show%20info/more%20tools";D.innerHTML=P?"%26larr;":"%26rarr;";D.title=P?"Reverse":"Un-reverse";R.innerHTML="%26#9664;%26#10073;";R.title="Previous%20frame";Q.innerHTML="%26#10073;%26#9654;";Q.title="Next%20frame";B.innerHTML=r?"%26#9675;":"%26#8857;";B.title=r?"Unpin":"Pin";A.innerHTML="%26#10006;";A.title="Close%20jsgif%20and%20go%20back%20to%20original%20image";v.disabled=G;q.disabled=G;K.innerHTML="";H.innerHTML="";z.innerHTML="";if(M.length<2){if(af=="xhr"){K.appendChild(document.createTextNode("Load%20failed;%20cross-domain?%20"));var%20al=ak("button","popup");al.addEventListener("click",function(){window.open(ai.src)});al.innerHTML="%26nearr;";al.title="Click%20to%20open%20GIF%20in%20new%20window;%20try%20running%20jsgif%20there%20instead";K.appendChild(al)}else{af=="parse"%26%26K.appendChild(document.createTextNode("Parse%20failed%20"))}K.appendChild(A)}else{al=function(an,ao){an.innerHTML="";ao.forEach(function(ap){an.appendChild(ap)})};var%20am=P?[E,D,R,W,Q,B,A]:[E,D,Q,W,R,B,A];al(K,[H,z]);al(H,am);al(z,[document.createTextNode("%20frame:%20"),v,document.createTextNode("%20/%20"),document.createTextNode(M.length),document.createTextNode("%20(delay:%20"),q,document.createTextNode(")")])}}function%20ak(am,an,al){am=document.createElement(am);if(an){am.className="jsgif_"+an}for(var%20ao%20in%20al){am[ao]=al[ao]}return%20am}var%20H=ak("div","simple_tools"),D=ak("button","rev"),E=ak("button","show_info"),R=ak("button","prev"),W=ak("button","play_pause"),Q=ak("button","next"),B=ak("button","pin"),A=ak("button","close"),z=ak("div","info_tools");v=ak("input","cur_frame",{type:"text"});q=ak("input","delay_info",{type:"text"});E.addEventListener("click",function(){m=!m;aa();E.focus()},C);D.addEventListener("click",function(){P=!P;aa();D.focus()},C);v.addEventListener("change",function(){var%20al=+v.value;if(isNaN(al)||al<1||al>M.length){v.value=t+1}else{t=al-1;O.putImageData(M[t].data,0,0)}},C);R.addEventListener("click",function(){p(-1)},C);W.addEventListener("click",S,C);Q.addEventListener("click",function(){p(1)},C);B.addEventListener("click",function(){r=!r;aa();B.focus()},C);A.addEventListener("click",I,C);q.addEventListener("change",function(){var%20al=+q.value;if(!isNaN(al)){M[t].f=al}},C);J.addEventListener("click",S,C);L.addEventListener("click",function(al){al.preventDefault()},C);aa()}function%20p(z){t=(t+z+M.length)%25M.length;v.value=t+1;q.value=M[t].f;O.putImageData(M[t].data,0,0)}var%20t=-1,v,q,m=C,r=C,u=function(){function%20z(){if(A=G){p(P?1:-1);var%20B=M[t].f*10;B||(B=100);setTimeout(z,B)}}var%20A=C;return%20function(){A||setTimeout(z,0)}}();return%20function(){setTimeout(y,0);if(!af){J.width=ae.width;J.height=ae.height;u()}}}(),aj={p:ag(function(m){ae=m;J.width=ae.width;J.height=ae.height;L.style.width=ae.width+"px";K.style.minWidth=ae.width+"px";X.width=ae.width;X.height=ae.height}),o:ag(function(m){F();Y=U=n;s=w;N=w=n;U=m.L?m.M:n;Y=m.u;w=m.v}),m:ag(ac),c:{l:ag(ac)},q:ag(function(q){N||(N=X.getContext("2d"));var%20m=q.r?q.C:ae.w,p=N.getImageData(q.g,q.k,q.width,q.height);q.h.forEach(function(t,r){if(U!==t){p.data[r*4+0]=m[t][0];p.data[r*4+1]=m[t][1];p.data[r*4+2]=m[t][2];p.data[r*4+3]=255}else{if(s===2||s===3){p.data[r*4+3]=0}}});N.putImageData(p,q.g,q.k);O.putImageData(p,q.g,q.k)},true),n:function(){F();T(C);K.innerHTML="Playing...";x()}},o=ai.parentNode,L=document.createElement("div"),J=document.createElement("canvas"),O=J.getContext("2d"),K=document.createElement("div"),X=document.createElement("canvas");J.width=ai.width;J.height=ai.height;K.style.minWidth=ai.width+"px";L.className="jsgif";K.className="jsgif_toolbar";L.appendChild(J);L.appendChild(K);o.insertBefore(L,ai);o.removeChild(ai);K.innerHTML="Loading...";(function(){var%20m=new%20XMLHttpRequest;m.overrideMimeType("text/plain;%20charset=x-user-defined");m.onload=function(){Z=new%20f(m.responseText);setTimeout(ad,0)};m.onprogress=ah;m.onerror=function(){V("xhr")};m.open("GET",ai.src,true);m.send()})()}function%20b(o,u){function%20r(){var%20q={};q.s=o.a();switch(String.fromCharCode(q.s)){case"!":q.type="ext";p(q);break;case",":q.type="img";s(q);break;case";":q.type="eof";u.n%26%26u.n(q);break;default:throw%20Error("Unknown%20block:%200x"+q.s.toString(16))}q.type!=="eof"%26%26setTimeout(r,0)}function%20s(q){function%20v(F,I){function%20J(y,B){var%20D=F.slice(B*I,(B+1)*I);A.splice.apply(A,[y*I,I].concat(D))}for(var%20A=Array(F.length),E=F.length/I,H=[0,4,2,1],G=[8,8,4,2],x=0,K=0;K<4;K++){for(var%20z=H[K];z<E;z+=G[K]){J(z,x);x++}}return%20A}q.g=o.b();q.k=o.b();q.width=o.b();q.height=o.b();var%20w=l(o.a());q.r=w.shift();q.B=w.shift();q.J=w.shift();q.H=w.splice(0,2);q.D=e(w.splice(0,3));if(q.r){q.C=m(1<<q.D+1)}q.F=o.a();w=t();q.h=a(q.F,w);if(q.B){q.h=v(q.h,q.width)}u.q%26%26u.q(q)}function%20p(q){function%20w(A){function%20z(B){o.a();B.t=o.a();B.R=o.b();B.K=o.a();u.c%26%26u.c.l%26%26u.c.l(B)}o.a();A.identifier=o.d(8);A.O=o.d(3);switch(A.identifier){case"NETSCAPE":z(A);break;default:(function(B){B.N=t();u.c%26%26u.c[B.identifier]%26%26u.c[B.identifier](B)})(A)}}function%20x(z){o.a();z.V=o.j(12);z.U=t();u.G%26%26u.G(z)}function%20v(z){z.Q=t();u.m%26%26u.m(z)}function%20y(A){o.a();var%20z=l(o.a());A.H=z.splice(0,3);A.v=e(z.splice(0,3));A.W=z.shift();A.L=z.shift();A.u=o.b();A.M=o.a();A.K=o.a();u.o%26%26u.o(A)}q.label=o.a();switch(q.label){case%20249:q.e="gce";y(q);break;case%20254:q.e="com";v(q);break;case%201:q.e="pte";x(q);break;case%20255:q.e="app";w(q);break;default:q.e="unknown";(function(z){z.data=t();u.t%26%26u.t(z)})(q)}}function%20t(){var%20q,v;v="";do{q=o.a();v+=o.d(q)}while(q!==0);return%20v}function%20m(q){for(var%20v=[],w=0;w<q;w++){v.push(o.j(3))}return%20v}u||(u={});(function(){var%20q={};q.I=o.d(3);q.X=o.d(3);if(q.I!=="GIF"){throw%20Error("Not%20a%20GIF%20file.")}q.width=o.b();q.height=o.b();var%20v=l(o.a());q.z=v.shift();q.P=e(v.splice(0,3));q.J=v.shift();q.A=e(v.splice(0,3));q.bgColor=o.a();q.T=o.a();if(q.z){q.w=m(1<<q.A+1)}u.p%26%26u.p(q)})();setTimeout(r,0)}function%20a(y,w){function%20s(){t=[];r=y+1;for(var%20q=0;q<o;q++){t[q]=[q]}t[o]=[];t[x]=n}function%20m(A){for(var%20z=0,q=0;q<A;q++){if(w.charCodeAt(B>>3)%261<<(B%267)){z|=1<<q}B++}return%20z}for(var%20B=0,v=[],o=1<<y,x=o+1,r=y+1,t=[],p,u;;){u=p;p=m(r);if(p===o){s()}else{if(p===x){break}if(p<t.length){u!==o%26%26t.push(t[u].concat(t[p][0]))}else{if(p!==t.length){throw%20Error("Invalid%20LZW%20code.")}t.push(t[u].concat(t[u][0]))}v.push.apply(v,t[p]);t.length===1<<r%26%26r<12%26%26r++}}return%20v}function%20f(m){this.data=m;this.S=this.data.length;this.i=0;this.a=function(){if(this.i>=this.data.length){throw%20Error("Attempted%20to%20read%20past%20end%20of%20stream.")}return%20m.charCodeAt(this.i++)%26255};this.j=function(r){for(var%20o=[],p=0;p<r;p++){o.push(this.a())}return%20o};this.d=function(r){for(var%20o="",p=0;p<r;p++){o+=String.fromCharCode(this.a())}return%20o};this.b=function(){var%20o=this.j(2);return(o[1]<<8)+o[0]}}function%20l(m){for(var%20p=[],o=7;o>=0;o--){p.push(!!(m%261<<o))}return%20p}function%20e(m){return%20m.reduce(function(p,o){return%20p*2+o},0)}var%20k=function(m){for(var%20p=[],o=0;o<m.length;o++){p.push(m[o])}return%20p}(document.getElementsByTagName("img")),c=k.filter(function(m){return%20m.src.slice(-4).toLowerCase()===".gif"});if(c.length===0){c=k}(function(m){var%20o=document.createElement("style");o.type="text/css";o.textContent=m;document.body.appendChild(o)})(".jsgif{display:inline;position:relative;padding-bottom:3px;}.jsgif_toolbar{visibility:hidden;font-family:sans-serif;background-color:#555;border-radius:8px;-moz-border-radius:8px;-webkit-border-radius:8px;overflow:visible;white-space:nowrap;padding:3px;position:absolute;left:0;text-align:center;z-index:50;}.jsgif_toolbar%20button{width:3em;color:black;text-align:center;border-radius:8px;-moz-border-radius:8px;-webkit-border-radius:8px;margin:1px;cursor:pointer;background-color:#ddd;}.jsgif_cur_frame{width:2em;color:black;}.jsgif_delay_info{width:2em;color:black;}.jsgif_toolbar%20button:hover{color:red;}.jsgif:hover%20.jsgif_toolbar{visibility:visible;}.jsgif{text-decoration:none;color:black;}.jsgif_overlaid{border:5px%20solid%20red;}.jsgif_overlaid:hover{border:5px%20solid%20blue;}");c.forEach(function(m){if(m.className.split(/\s/).indexOf("jsgif_overlaid")===-1){m.className+="%20jsgif_overlaid";m.addEventListener("click",i,C)}})})();
